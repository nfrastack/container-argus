	#!/command/with-contenv bash
# SPDX-FileCopyrightText: Â© 2025 Nfrastack <code@nfrastack.com>
#
# SPDX-License-Identifier: MIT

source /container/base/functions/container/init
SERVICE_NAME="argus"
set -a
prepare_service 20-argus
set +a

check_container_initialized
check_service_initialized init

liftoff
case "${LOG_TYPE,,}" in
    both )
        out=/dev/stdout
        pipe="tee -a ${LOG_PATH}/${LOG_FILE}"
    ;;
    console )
        out=/dev/stdout
        pipe="cat"
    ;;
    file )
        out="${LOG_PATH}/${LOG_FILE}"
        pipe="silent tee /dev/null"
    ;;
esac

transform_var file ARGUS_ARGS
print_start "Starting Argus ${ARGUS_VERSION}"
s6-setuidgid argus \
                    exec argus --config.file "${CONFIG_PATH}/${CONFIG_FILE}" ${ARGUS_ARGS} >> "${out}" 2>&1 | ${pipe}